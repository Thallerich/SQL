DECLARE @ImportFile TABLE (
  EtiNr nchar(10) COLLATE Latin1_General_CS_AS,
  Datum date
);

DECLARE @Webportal TABLE (
  EtiNr nchar(10) COLLATE Latin1_General_CS_AS,
  Datum date
);

INSERT INTO @ImportFile (EtiNr, Datum)
VALUES ('3377149532', '2025-05-28'), ('3377044592', '2025-05-28'), ('3376940307', '2025-05-28'), ('3376763050', '2025-05-28'), ('3376763319', '2025-05-28'), ('3376938137', '2025-05-28'), ('3376763005', '2025-05-28'), ('3376938533', '2025-05-28'), ('3376852075', '2025-05-28'), ('3376763258', '2025-05-28'), ('3376763067', '2025-05-28'), ('3373890988', '2025-05-28'), ('3369646155', '2025-05-28'), ('3377045254', '2025-05-28'), ('3374846403', '2025-05-28'), ('3376551329', '2025-05-28'), ('3376660595', '2025-05-28'), ('3376209695', '2025-05-28'), ('3377043045', '2025-05-28'), ('3376660694', '2025-05-28'), ('3376210097', '2025-05-28'), ('3376295568', '2025-05-28'), ('3376295162', '2025-05-28'), ('3375930903', '2025-05-28'), ('3376851979', '2025-05-28'), ('3376852952', '2025-05-28'), ('3376764903', '2025-05-28'), ('3376764576', '2025-05-28'), ('3376940239', '2025-05-28'), ('3377045384', '2025-05-28'), ('3377045193', '2025-05-28'), ('3376388758', '2025-05-28'), ('3377044882', '2025-05-28'), ('3376938878', '2025-05-28'), ('3377044714', '2025-05-28'), ('3376295872', '2025-05-28'), ('3377044967', '2025-05-28'), ('3377149501', '2025-05-29'), ('3377232166', '2025-05-29'), ('3373988555', '2025-05-29'), ('3376387706', '2025-05-29'), ('3377044158', '2025-05-29'), ('3375063052', '2025-05-29'), ('3373798475', '2025-05-29'), ('3376851849', '2025-05-29'), ('3377233347', '2025-05-29'), ('3376938977', '2025-05-29'), ('3377149518', '2025-05-29'), ('3376661905', '2025-05-29'), ('3376852099', '2025-05-29'), ('3376938151', '2025-05-29'), ('3376938823', '2025-05-29'), ('3376938267', '2025-05-29'), ('3376937321', '2025-05-29'), ('3377149617', '2025-05-29'), ('3376938175', '2025-05-29'), ('3377352154', '2025-05-29'), ('3376938731', '2025-05-29'), ('3376661561', '2025-05-29'), ('3377149716', '2025-05-29'), ('3377149549', '2025-05-29'), ('3377353090', '2025-05-29'), ('3377150217', '2025-05-29'), ('3377352970', '2025-05-29'), ('3377149822', '2025-05-29'), ('3377149631', '2025-05-29'), ('3376662032', '2025-05-29'), ('3377354776', '2025-05-29'), ('3377354967', '2025-05-29'), ('3376551190', '2025-05-29'), ('3377232876', '2025-05-29'), ('3377232494', '2025-05-29'), ('3377232814', '2025-05-29'), ('3377149563', '2025-05-29'), ('3377233231', '2025-05-30'), ('3377232661', '2025-05-30'), ('3377149334', '2025-05-31'), ('3377149457', '2025-05-31'), ('3377352475', '2025-05-31'), ('3377232142', '2025-05-31'), ('3376550698', '2025-05-31'), ('3377352178', '2025-05-31'), ('3377149303', '2025-05-31'), ('3375556073', '2025-05-31'), ('3376939875', '2025-05-31'), ('3377044523', '2025-05-31'), ('3376938519', '2025-05-31'), ('3377233323', '2025-05-31'), ('3376108882', '2025-05-31'), ('3376938151', '2025-05-31'), ('3377232265', '2025-05-31'), ('3377044417', '2025-05-31'), ('3376550124', '2025-05-31'), ('3376661400', '2025-05-31'), ('3377043908', '2025-05-31'), ('3377354622', '2025-05-31'), ('3377354516', '2025-05-31'), ('3376551763', '2025-05-31'), ('3377353274', '2025-05-31'), ('3377353670', '2025-05-31'), ('3376388239', '2025-05-31'), ('3377232869', '2025-05-31'), ('3377232623', '2025-05-31');

INSERT INTO @Webportal (EtiNr, Datum)
VALUES ('3360156851', '2025-06-01'), ('3364630876', '2025-05-28'), ('3364639459', '2025-06-01'), ('3369646155', '2025-05-27'), ('3369646155', '2025-05-28'), ('3373798475', '2025-05-28'), ('3373890988', '2025-05-28'), ('3373988555', '2025-05-28'), ('3374954825', '2025-05-27'), ('3375556073', '2025-05-30'), ('3375930903', '2025-05-28'), ('3376111189', '2025-05-31'), ('3376209695', '2025-05-27'), ('3376210097', '2025-05-27'), ('3376295162', '2025-05-27'), ('3376295568', '2025-05-27'), ('3376295599', '2025-05-31'), ('3376387706', '2025-05-28'), ('3376388758', '2025-05-27'), ('3376473010', '2025-05-31'), ('3376550698', '2025-05-30'), ('3376551190', '2025-05-28'), ('3376551329', '2025-05-27'), ('3376660595', '2025-05-27'), ('3376660595', '2025-05-28'), ('3376660694', '2025-05-27'), ('3376661189', '2025-05-31'), ('3376661400', '2025-05-30'), ('3376661561', '2025-05-28'), ('3376661905', '2025-05-28'), ('3376662032', '2025-05-28'), ('3376763050', '2025-05-27'), ('3376763067', '2025-05-27'), ('3376763258', '2025-05-27'), ('3376763319', '2025-05-27'), ('3376764095', '2025-05-31'), ('3376764576', '2025-05-27'), ('3376851795', '2025-05-30'), ('3376851849', '2025-05-27'), ('3376851979', '2025-05-28'), ('3376852099', '2025-05-27'), ('3376852266', '2025-05-28'), ('3376852785', '2025-05-28'), ('3376852921', '2025-05-30'), ('3376937321', '2025-05-28'), ('3376938137', '2025-05-27'), ('3376938151', '2025-05-28'), ('3376938151', '2025-05-30'), ('3376938175', '2025-05-28'), ('3376938267', '2025-05-28'), ('3376938519', '2025-05-30'), ('3376938533', '2025-05-27'), ('3376938731', '2025-05-28'), ('3376938823', '2025-05-28'), ('3376938823', '2025-05-31'), ('3376938878', '2025-05-27'), ('3376938977', '2025-05-28'), ('3376939363', '2025-05-27'), ('3376939882', '2025-05-30'), ('3376940239', '2025-05-27'), ('3376940307', '2025-05-27'), ('3377043366', '2025-05-31'), ('3377043908', '2025-05-30'), ('3377044158', '2025-05-28'), ('3377044523', '2025-05-30'), ('3377044592', '2025-05-27'), ('3377044714', '2025-05-27'), ('3377044967', '2025-05-27'), ('3377045193', '2025-05-27'), ('3377045254', '2025-05-27'), ('3377045384', '2025-05-27'), ('3377149303', '2025-05-30'), ('3377149334', '2025-05-30'), ('3377149501', '2025-05-28'), ('3377149518', '2025-05-28'), ('3377149532', '2025-05-27'), ('3377149549', '2025-05-28'), ('3377149563', '2025-05-27'), ('3377149716', '2025-05-28'), ('3377149822', '2025-05-27'), ('3377150217', '2025-05-28'), ('3377232142', '2025-05-30'), ('3377232166', '2025-05-28'), ('3377232265', '2025-05-30'), ('3377232494', '2025-05-28'), ('3377232623', '2025-05-30'), ('3377232739', '2025-05-27'), ('3377232814', '2025-05-27'), ('3377232869', '2025-05-30'), ('3377232876', '2025-05-28'), ('3377233231', '2025-05-28'), ('3377233323', '2025-05-30'), ('3377233347', '2025-05-27'), ('3377352178', '2025-05-30'), ('3377352475', '2025-05-30'), ('3377352796', '2025-05-31'), ('3377352970', '2025-05-28'), ('3377353090', '2025-05-28'), ('3377353274', '2025-05-30'), ('3377353670', '2025-05-30'), ('3377354516', '2025-05-30'), ('3377354622', '2025-05-30'), ('3377354776', '2025-05-28'), ('3377354967', '2025-05-28')

SELECT Artikel.ArtikelNr, Artikel.ArtikelBez AS Artikelbezeichnung, Kunden.KdNr, Vsa.VsaNr, Vsa.Bez AS [Vsa-Bezeichnung], OPEtiKo.EtiNr AS Seriennummer, IIF(ImportFile.EtiNr IS NOT NULL, DATEADD(day, -1, ImportFile.Datum), NULL) AS Schnittstelle, IIF(Webportal.EtiNr IS NOT NULL, Webportal.Datum, NULL) AS Webportal
FROM OPEtiKo
JOIN Artikel ON OPEtiKo.ArtikelID = Artikel.ID
JOIN Vsa ON OPEtiKo.VsaID = Vsa.ID
JOIN Kunden ON Vsa.KundenID = Kunden.ID
LEFT JOIN @ImportFile AS ImportFile ON OPEtiKo.EtiNr = ImportFile.EtiNr
LEFT JOIN @Webportal AS Webportal ON OPEtiKo.EtiNr = Webportal.EtiNr
WHERE OPEtiKo.EtiNr IN (SELECT EtiNr FROM @ImportFile UNION SELECT EtiNr FROM @Webportal)
ORDER BY ArtikelNr ASC;

GO

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
/* ++ Webportal-Query                                                                                                           ++ */
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */

/* 
SELECT msgOpEtiKo.EtiNr, CAST(msgOpEtiKo.Anlage_ AS date) AS Datum
FROM msgOpEtiKo
WHERE msgOpEtiKo.WebUserID IN (SELECT WebUser.ID FROM WebUser WHERE WebUser.KundenID = (SELECT ID FROM Kunden WHERE KdNr = 202013))
  AND msgOpEtiKo.Anlage_ >= N'2025-05-28 00:00:00';
 */